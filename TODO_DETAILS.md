# TaskPomodoro TODO 詳細説明書

> 各TODO項目の必要性、実装内容、用語解説を記載したドキュメント

## 目次
- [API基盤・データベース](#api基盤データベース)
- [DTO・Controllers](#dto・controllers)
- [テスト](#テスト)
- [Webフロントエンド](#webフロントエンド)
- [アクセシビリティ・品質](#アクセシビリティ品質)
- [CI・ドキュメント・リポジトリ](#ciドキュメントリポジトリ)

---

## API基盤・データベース

### global.json で .NET SDK バージョンを固定
**必要性**: チーム開発やCI環境で一貫した.NET SDKバージョンを使用するため
**説明**: プロジェクトルートに`global.json`を配置し、使用する.NET SDKのバージョンを固定。これにより異なる環境でも同じバージョンでビルド・実行されることを保証
**用語**: 
- **global.json**: .NET SDKのバージョン制約を定義する設定ファイル
- **SDK固定**: 特定のバージョンの.NET SDKのみを使用するよう制限すること

### AppDbContext を作成（DbSet<Task>, DbSet<Session>）
**必要性**: Entity Framework Coreでデータベース操作を行うための中心的なクラス
**説明**: `DbContext`を継承したクラスを作成し、`Task`と`Session`エンティティの`DbSet`プロパティを定義。データベースとの接続、エンティティの管理、変更追跡を担当
**用語**:
- **DbContext**: EF Coreの中心クラス。データベースセッションを表し、エンティティの管理と変更追跡を行う
- **DbSet<T>**: 特定のエンティティタイプのコレクションを表すプロパティ

### appsettings.json に接続文字列を追加
**必要性**: データベースへの接続情報を設定ファイルで管理するため
**説明**: SQLiteデータベースへの接続文字列`Data Source=app.db;Cache=Shared;`を`appsettings.json`に追加
**用語**:
- **接続文字列**: データベースに接続するために必要な情報（データソース、認証情報等）を文字列で表現したもの
- **SQLite**: 軽量なファイルベースのリレーショナルデータベース

### 開発/本番環境の接続切替
**必要性**: 環境ごとに異なるデータベース設定を使用するため
**説明**: `appsettings.Development.json`で開発用設定を上書きし、本番環境では異なる接続文字列を使用できるようにする
**用語**:
- **環境別設定**: 開発・ステージング・本番など、環境ごとに異なる設定値を使用すること
- **設定の上書き**: より具体的な設定ファイルが基本設定を上書きする仕組み

### Task エンティティ定義
**必要性**: タスク情報をデータベースに保存するためのデータ構造を定義
**説明**: タスクの基本情報（タイトル、メモ、見積りポモ数、アーカイブ状態、作成日時）を含むエンティティクラスを作成
**用語**:
- **エンティティ**: データベースのテーブルに対応するクラス
- **データ注釈**: クラスのプロパティに属性を付けて、検証ルールやデータベース制約を定義する方法

### Session エンティティ定義
**必要性**: ポモドーロセッション（作業・休憩時間）の記録を保存するため
**説明**: セッション情報（タスクID、種類、予定時間、実際の時間、開始・終了時刻）を含むエンティティクラスを作成
**用語**:
- **セッション**: ポモドーロの1回の作業または休憩の単位
- **外部キー**: 他のテーブルの主キーを参照する列

### DailySummary は動的集計として実装
**必要性**: 日別の成果をリアルタイムで計算・表示するため
**説明**: `DailySummary`はエンティティではなく、`Session`テーブルから動的に集計した結果として実装。`Date`、`FocusPomos`、`FocusMinutes`、`BreakMinutes`を計算
**用語**:
- **動的集計**: データベースからリアルタイムで計算した結果
- **計算結果**: エンティティではなく、クエリ結果として返されるデータ

### Task-Session リレーション設定
**必要性**: タスクとセッションの関連性をデータベースレベルで保証するため
**説明**: `Task`と`Session`の間の1対多の関係を設定し、外部キー制約を定義
**用語**:
- **リレーション**: テーブル間の関連性（1対1、1対多、多対多）
- **外部キー制約**: 参照整合性を保証するためのデータベース制約

### 検証属性付与
**必要性**: データの整合性を保つため、不正なデータの保存を防ぐ
**説明**: `Required`、`MaxLength`、`Range`などの属性をプロパティに付与してバリデーションルールを定義
**用語**:
- **バリデーション**: データが指定されたルールに従っているかをチェックすること
- **DataAnnotations**: .NETで提供される検証属性のセット

### IRepository<T> 抽象定義
**必要性**: データアクセス層を抽象化し、テスト容易性とDB置換可能性を向上
**説明**: 基本的なCRUD操作（Create, Read, Update, Delete）を定義するジェネリックインターフェイスを作成
**用語**:
- **Repository パターン**: データアクセスロジックをカプセル化するデザインパターン
- **抽象化**: 実装の詳細を隠蔽し、インターフェイスを通じてアクセスすること

### IUnitOfWork 抽象定義
**必要性**: 複数の操作を1つのトランザクションとして管理するため
**説明**: データベースの変更をまとめて保存する`SaveChangesAsync`メソッドを定義するインターフェイス
**用語**:
- **Unit of Work パターン**: 複数の操作を1つのトランザクションとして管理するパターン
- **トランザクション**: 複数の操作を原子性（すべて成功またはすべて失敗）で実行する仕組み

### EfRepository<T> 実装
**必要性**: `IRepository<T>`の具体的な実装を提供
**説明**: Entity Framework Coreを使用して`IRepository<T>`を実装し、基本的なCRUD操作と`IQueryable`の返却を実装
**用語**:
- **IQueryable**: LINQクエリを遅延実行するためのインターフェイス
- **遅延実行**: クエリが実際に実行されるまで評価を遅らせる仕組み

### UnitOfWork 実装
**必要性**: `IUnitOfWork`の具体的な実装を提供
**説明**: `DbContext`を内包し、`SaveChangesAsync`メソッドを実装してトランザクション管理を行う
**用語**:
- **DI（依存性注入）**: オブジェクトの依存関係を外部から注入する仕組み
- **スコープ**: オブジェクトのライフサイクル管理の単位

### DI 登録（DbContext、Repository、UnitOfWork）
**必要性**: アプリケーション全体で依存関係を管理し、テスト容易性と保守性を向上させるため
**説明**: `Program.cs`でDIコンテナにサービスを登録し、コンストラクタインジェクションで依存関係を注入。DbContextはスコープ、Repository/UoWもスコープで登録
**用語**:
- **DIコンテナ**: 依存関係の管理とインスタンスの作成・破棄を行うコンテナ
- **AddDbContext**: EF CoreのDbContextをDIコンテナに登録する拡張メソッド
- **AddScoped**: スコープ単位（HTTPリクエスト単位）でインスタンスを管理する登録方法
- **コンストラクタインジェクション**: コンストラクタを通じて依存関係を注入する方法

### 初回マイグレーション作成
**必要性**: データベーススキーマをコードで管理し、バージョン管理するため
**説明**: `dotnet ef migrations add Init`コマンドで初回マイグレーションファイルを作成
**用語**:
- **マイグレーション**: データベーススキーマの変更をコードで管理する仕組み
- **Code First**: エンティティクラスからデータベーススキーマを生成するアプローチ

### DB作成・更新
**必要性**: マイグレーションを実際のデータベースに適用するため
**説明**: `dotnet ef database update`コマンドでマイグレーションを実行し、データベースファイルを生成
**用語**:
- **スキーマ**: データベースの構造（テーブル、列、制約等）の定義
- **適用**: マイグレーションの変更を実際のデータベースに反映すること

---

## DTO・Controllers

### Task DTO 定義
**必要性**: APIの入出力で使用するデータ構造を定義し、エンティティと分離するため
**説明**: `TaskCreate`、`TaskUpdate`、`TaskResponse`のDTOクラスを作成し、APIの契約を明確化
**用語**:
- **DTO（Data Transfer Object）**: データ転送専用のオブジェクト
- **契約**: APIの入出力形式の仕様

### Session DTO 定義
**必要性**: セッション関連のAPI入出力を定義するため
**説明**: `SessionCreate`、`SessionComplete`、`SessionResponse`のDTOクラスを作成
**用語**:
- **API契約**: クライアントとサーバー間のデータ交換形式の約束事
- **シリアライゼーション**: オブジェクトをJSONなどの形式に変換すること

### TasksController 各エンドポイント
**必要性**: タスクのCRUD操作を提供するRESTful APIエンドポイントを実装
**説明**: 
- `GET /api/tasks?status=active|archived`: タスク一覧取得
- `POST /api/tasks`: 新規タスク作成
- `PATCH /api/tasks/{id}`: タスク更新
- `DELETE /api/tasks/{id}`: タスク削除
**用語**:
- **RESTful API**: HTTPメソッドとURLでリソース操作を表現するAPI設計
- **HTTPステータスコード**: リクエストの結果を表す3桁の数値（200=成功、404=見つからない等）

### SessionsController 各エンドポイント
**必要性**: ポモドーロセッションの管理APIを提供
**説明**:
- `POST /api/sessions`: セッション開始
- `PATCH /api/sessions/{id}/complete`: セッション完了
- `GET /api/sessions?date=YYYY-MM-DD`: 指定日のセッション一覧
**用語**:
- **リソース**: APIで操作する対象（タスク、セッション等）
- **クエリパラメータ**: URLの`?`以降に付与する検索条件等のパラメータ

### SummaryController エンドポイント
**必要性**: 集計データを提供するAPIエンドポイントを実装
**説明**: `GET /api/summary?from&to`で指定期間の集計データ（フォーカス時間、ポモ数等）を取得
**用語**:
- **集計**: 複数のデータをまとめて計算すること（合計、平均、件数等）
- **期間指定**: 開始日と終了日でデータの範囲を限定すること

### DailySummary 計算ロジック実装
**必要性**: Sessionデータから日別の成果を動的に計算するため
**説明**: `Session`テーブルをクエリして、指定期間の`FocusPomos`、`FocusMinutes`、`BreakMinutes`を集計するロジックを実装。LINQクエリで`Kind=Focus`のセッションをカウント・合計
**用語**:
- **LINQ**: Language Integrated Query（統合言語クエリ）
- **GROUP BY**: データをグループ化して集計するSQL句

### ProducesResponseType 属性付与
**必要性**: APIドキュメントの自動生成とクライアント開発の支援
**説明**: 各アクションメソッドに`[ProducesResponseType]`属性を付与して、返却可能なHTTPステータスコードを明記
**用語**:
- **OpenAPI/Swagger**: API仕様を記述する標準形式
- **APIドキュメント**: APIの使用方法を説明する文書

---

## テスト

### xUnitテストプロジェクト作成
**必要性**: .NET用のテストフレームワークを設定し、テスト実行環境を構築するため
**説明**: `dotnet new xunit -n Api.Tests`でテストプロジェクトを作成し、メインプロジェクトへの参照を追加
**用語**:
- **xUnit**: .NET用のテストフレームワーク（Microsoft公式推奨）
- **テストプロジェクト**: テストコード専用の別プロジェクト

### テスト用パッケージ追加
**必要性**: テストに必要な機能（統合テスト、モック、アサーション）を提供するため
**説明**: 以下のパッケージを追加：
- `Microsoft.AspNetCore.Mvc.Testing`: 統合テスト用
- `Microsoft.EntityFrameworkCore.Sqlite`: テスト用SQLiteデータベース
- `Moq`: モック作成
- `FluentAssertions`: 読みやすいアサーション
**用語**:
- **NuGetパッケージ**: .NET用のライブラリ管理システム
- **統合テスト**: 複数コンポーネントを組み合わせたテスト
**ない場合**: HTTP経由の統合テストやSQLite実DBでの検証が困難となり、モックやアサーションの表現力も低下する

### テストディレクトリ構造作成
**必要性**: テストコードを整理し、保守性を向上させるため
**説明**: 以下のディレクトリ構造を作成：
- `Controllers/`: コントローラーテスト
- `Data/`: データアクセステスト
- `Integration/`: 統合テスト
- `Helpers/`: テストヘルパー
- `Fixtures/`: テストフィクスチャ
- `Mocks/`: モックオブジェクト
- `TestData/`: テストデータ
- `Utils/`: ユーティリティ
**用語**:
- **ディレクトリ構造**: ファイルの整理方法
- **保守性**: コードの修正・拡張のしやすさ
**ない場合**: テストが肥大化・分散し、重複/命名不整合/責務混在で保守が困難になる

### 統合テスト用SQLiteデータベース構成
**必要性**: テスト実行時に本番データを汚染しないため
**説明**: テスト専用のSQLiteファイル（例：`test.db`）を使用する構成を用意。`WebApplicationFactory`を使用してテスト環境を構築し、テスト用の接続文字列を設定
**用語**:
- **統合テスト**: 複数のコンポーネントを組み合わせてテストすること
- **テストデータベース**: テスト専用に用意されたデータベース
- **WebApplicationFactory**: ASP.NET Coreの統合テスト用ファクトリ
- **SQLite**: 軽量なファイルベースのリレーショナルデータベース
**ない場合**: 本番/開発DBへ誤接続やファイルロック、テスト同士のデータ汚染で再現性・安定性が著しく低下する

### Controller ユニットテスト
**必要性**: 各コントローラの動作を個別に検証するため
**説明**: Moqを使用してRepositoryとUnitOfWorkをモック化し、コントローラの各アクションをテスト。HTTPステータスコード、レスポンスデータ、バリデーションエラーを検証
**用語**:
- **ユニットテスト**: 最小単位の機能をテストすること
- **モック**: テスト用の偽のオブジェクト
- **アサーション**: 期待値と実際の値を比較してテスト結果を判定
**ない場合**: リグレッションを検出できず、I/O契約破壊（HTTPコード/レスポンス形）の不具合が本番まで潜む

### Repository/UnitOfWork ユニットテスト
**必要性**: データアクセス層の動作を検証するため
**説明**: EfRepositoryとUnitOfWorkの各メソッドをテストし、CRUD操作とトランザクション処理が正しく動作することを確認
**用語**:
- **CRUD**: Create, Read, Update, Delete（作成、読み取り、更新、削除）
- **トランザクション**: 複数の操作を原子性で実行する仕組み
**ない場合**: クエリの漏れや副作用、保存失敗時の扱いなどが未検出のまま運用に流出する

### 検証・例外テスト
**必要性**: エラーハンドリングとバリデーションが正しく動作することを確認
**説明**: 無効なデータ送信時の400エラー応答とProblemDetails変換をテスト。ModelStateの検証エラー、ビジネスルール違反、例外処理を網羅的にテスト
**用語**:
- **ProblemDetails**: エラー情報を標準化した形式（RFC 7807）
- **例外ハンドリング**: エラーが発生した際の適切な処理
- **バリデーション**: データの妥当性をチェックすること
**ない場合**: 400/404/409やProblemDetailsの整形不備が見逃され、クライアントの実装・UXを阻害する

### テストデータビルダー実装
**必要性**: テストで使用するデータを効率的に作成するため
**説明**: `TestDataBuilder`クラスでテスト用のエンティティやDTOを簡単に作成できるファクトリメソッドを実装
**用語**:
- **ビルダーパターン**: オブジェクトの作成を段階的に行うデザインパターン
- **ファクトリメソッド**: オブジェクトの作成を担当するメソッド
**ない場合**: テストデータが各所に散在し、境界値の網羅や修正の反映漏れが発生する

### テストフィクスチャ実装
**必要性**: テストで使用する共通のセットアップとクリーンアップを管理するため
**説明**: `DatabaseFixture`でデータベースの初期化、`WebApplicationFixture`でWebアプリケーションの設定を行う
**用語**:
- **フィクスチャ**: テストの前準備と後片付けを行う仕組み
- **セットアップ**: テスト実行前の準備処理
- **クリーンアップ**: テスト実行後の後片付け処理
**ない場合**: DB初期化漏れや後始末忘れにより、テスト順序や残骸データでテストが不安定化する

### モックファクトリ実装
**必要性**: テストで使用するモックオブジェクトを効率的に作成するため
**説明**: `MockRepositoryFactory`でRepositoryやUnitOfWorkのモックを簡単に作成できるファクトリメソッドを実装
**用語**:
- **ファクトリパターン**: オブジェクトの作成を専門に行うクラス
- **モック**: テスト用の偽のオブジェクト
**ない場合**: モックの重複生成と設定ミスが増え、テスト可読性と信頼性が低下する

### テスト用 appsettings.json
**必要性**: テスト専用の接続文字列・ログレベルで再現性と安全性を担保
**説明**: `Api.Tests/appsettings.json`に`Data Source=test.db;Cache=Shared;`等を定義し、実運用設定と分離
**ない場合**: 開発/本番の設定が読み込まれ、DB汚染やノイズログで原因解析が困難に

### xunit.runner.json
**必要性**: 並列実行と出力形式を制御し、SQLiteロックや順序依存失敗を回避
**説明**: `Api.Tests/xunit.runner.json`で`parallelizeTestCollections`等を設定
**ない場合**: テストの衝突・実行順序による不安定化や、出力の可視性低下が発生

---

## Webフロントエンド

### API クライアント実装
**必要性**: フロントエンドからAPIを呼び出すための共通インターフェイスを提供
**説明**: `lib/api`ディレクトリにtasks、sessions、summaryの各APIを呼び出す関数を実装
**用語**:
- **APIクライアント**: APIを呼び出すためのラッパー関数群
- **fetch**: JavaScriptでHTTPリクエストを送信する標準API

### 時間ユーティリティ実装
**必要性**: 時間の計算と表示形式の変換を統一するため
**説明**: `lib/time`にミリ秒とmm:ss形式の相互変換、ceil補正などの時間処理関数を実装
**用語**:
- **ユーティリティ**: 共通で使用される便利な関数群
- **ceil補正**: 端数を切り上げて整数にする処理

### TaskList コンポーネント
**必要性**: タスクの一覧表示と操作UIを提供
**説明**: タスクの検索、選択、アーカイブ切替機能を持つコンポーネントを作成
**用語**:
- **コンポーネント**: 再利用可能なUI部品
- **状態管理**: コンポーネントのデータの状態を管理すること

### Timer コンポーネント
**必要性**: ポモドーロタイマーの核となるUIを提供
**説明**: 状態遷移、残り時間表示、開始/一時停止/再開/スキップボタンを含むタイマーコンポーネントを作成
**用語**:
- **状態遷移**: タイマーの状態（Idle、Running、Paused等）の変化
- **イベントハンドリング**: ユーザーの操作（ボタンクリック等）に対する処理

### SummaryCard コンポーネント
**必要性**: 本日の成果を視覚的に表示
**説明**: 完了ポモ数、累計時間、直近セッションなどのサマリー情報を表示するカードコンポーネント
**用語**:
- **カードUI**: 情報をカード形式で整理して表示するUIパターン
- **ダッシュボード**: 複数の情報を一覧で表示する画面

### Dashboard ページ
**必要性**: アプリケーションのメイン画面を提供
**説明**: TaskListとTimerを2カラムレイアウトで配置したダッシュボードページを作成
**用語**:
- **ページ**: アプリケーションの画面単位
- **レイアウト**: UI要素の配置と構成

### タイマー状態管理
**必要性**: タイマーの複雑な状態遷移を適切に管理
**説明**: Idle、FocusRunning、FocusPaused、BreakRunning、BreakPausedの状態を管理するロジックを実装
**用語**:
- **状態マシン**: 有限の状態と遷移を管理する仕組み
- **副作用**: 状態変更に伴う処理（音声再生、通知等）

### セッション保存フロー
**必要性**: セッションの開始から完了まで一貫したデータ保存
**説明**: 開始時の暫定保存、完了/スキップ時の確定保存のロジックを実装
**用語**:
- **楽観的ロック**: データの競合を最小限に抑える手法
- **データ整合性**: データの一貫性と正確性を保つこと

---

## アクセシビリティ・品質

### キーボード操作・aria・コントラスト対応
**必要性**: 障害を持つユーザーもアプリケーションを使用できるようにするため
**説明**: WCAG 2.2 AAレベルに準拠したアクセシビリティ機能を実装
**用語**:
- **WCAG**: Web Content Accessibility Guidelines（Webコンテンツアクセシビリティガイドライン）
- **ARIA**: Accessible Rich Internet Applications（アクセシブルなリッチインターネットアプリケーション）

### axe による自動チェック
**必要性**: アクセシビリティの問題を自動的に検出するため
**説明**: `@axe-core/react`を使用してアクセシビリティの問題を自動検出
**用語**:
- **axe**: アクセシビリティテストツール
- **自動テスト**: 人間の手を介さずに実行されるテスト

### レスポンシブ対応
**必要性**: 様々な画面サイズでアプリケーションが適切に表示されるため
**説明**: 縦優先で主要ブレークポイントに対応したレスポンシブデザインを実装
**用語**:
- **レスポンシブデザイン**: 画面サイズに応じてレイアウトが変化するデザイン
- **ブレークポイント**: レイアウトが切り替わる画面幅の境界値

---

## CI・ドキュメント・リポジトリ

### GitHub Actions CI
**必要性**: コードの品質を自動的にチェックし、デプロイを自動化するため
**説明**: APIとWebのビルド、テスト実行を自動化するCIパイプラインを構築
**用語**:
- **CI/CD**: Continuous Integration/Continuous Deployment（継続的インテグレーション/継続的デプロイメント）
- **パイプライン**: 自動化された処理の流れ

### .gitignore 設定
**必要性**: 不要なファイルをGitで管理しないため
**説明**: `app.db`、`node_modules`、ビルド成果物などを`.gitignore`に追加
**用語**:
- **.gitignore**: Gitで追跡しないファイルを指定するファイル
- **ビルド成果物**: コンパイルやビルドで生成されるファイル

### README 作成
**必要性**: プロジェクトの概要と使用方法を他の開発者に伝えるため
**説明**: 起動手順、API概要、開発コマンドを記載したREADMEを作成
**用語**:
- **README**: プロジェクトの説明書
- **ドキュメント**: プロジェクトの使用方法や仕様を説明する文書

### コーディング規約・フォーマッタ導入
**必要性**: コードの一貫性を保ち、品質を向上させるため
**説明**: EditorConfig、Prettier、ESLintを導入してコードの自動整形と品質チェックを設定
**用語**:
- **EditorConfig**: エディタの設定を統一するファイル
- **Prettier**: コードの自動整形ツール
- **ESLint**: JavaScript/TypeScriptの静的解析ツール

---

## まとめ

このTODOリストは、TaskPomodoroアプリケーションの開発に必要な全ての要素を網羅的にカバーしています。各項目は相互に関連しており、段階的に実装することで、堅牢で保守性の高いアプリケーションを構築できます。

特に重要なのは：
1. **データ層の抽象化**（Repository/UoWパターン）
2. **APIの設計**（RESTful、適切なHTTPステータスコード）
3. **フロントエンドの状態管理**（タイマーの複雑な状態遷移）
4. **アクセシビリティ**（WCAG 2.2 AA準拠）
5. **テスト**（ユニット・統合・E2E）

これらの要素を適切に実装することで、ユーザビリティが高く、保守しやすいアプリケーションを実現できます。
